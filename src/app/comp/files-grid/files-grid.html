<div class="files-grid-viewport">
  <!-- toolbar -->
  <div class="files-grid-toolbar">
    <div class="left">
      <button (click)="downloadAll()" [disabled]="!rowData.length || isDownloadingAll" class="amplify-button amplify-button--primary">
        {{ isDownloadingAll ? 'Preparingâ€¦' : 'Download All' }}
      </button>
      <a *ngIf="downloadAllUrl && !actionError" [href]="downloadAllUrl" target="_blank" rel="noopener" style="font-size:13px; color:#2563eb; text-decoration:underline;">
        Or click here
      </a>
    </div>
    <div class="right">
      <input type="text" placeholder="Quick search..." [value]="quickFilterText" (input)="onQuickFilterChange($event)">

      <label>Patient</label>
      <select [value]="selectedPatient" (change)="selectedPatient = $any($event.target).value; applyPatientFilter()">
        <option value="">All</option>
        <option *ngFor="let p of uniquePatients" [value]="p">{{ p }}</option>
      </select>

      <label>From</label>
      <input type="time" step="1" [value]="timeFrom" (input)="timeFrom = $any($event.target).value">
      <label>To</label>
      <input type="time" step="1" [value]="timeTo" (input)="timeTo = $any($event.target).value">
      <button (click)="applyTimeRangeFilter()" class="amplify-button amplify-button--primary">Apply</button>
      <button (click)="clearTimeFilter()" class="amplify-button">Clear Time</button>
      <button (click)="clearAllFilters()" class="amplify-button">Clear All</button>
    </div>
  </div>

  <!-- messages -->
  <div *ngIf="loadError" class="msg msg-error">{{ loadError }}</div>
  <div *ngIf="actionError" class="msg msg-error">{{ actionError }}</div>

  <!-- grid -->
  <ag-grid-angular
    class="ag-theme-quartz"
    style="width:100%; max-width:1100px; height:520px;"
    [theme]="'legacy'"
    [components]="components"
    [context]="context"
    [defaultColDef]="defaultColDef"
    [rowData]="rowData"
    [columnDefs]="columnDefs"
    [quickFilterText]="quickFilterText"
    [pagination]="true"
    [paginationPageSize]="pageSize"
    [paginationPageSizeSelector]="pageSizeOptions"
    (gridReady)="onGridReady($event)"
    (cellClicked)="onCellClicked($event)"
    [enableCellTextSelection]="true">
  </ag-grid-angular>
</div>
